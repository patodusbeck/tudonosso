const {
  SlashCommandBuilder,
  EmbedBuilder,
  ActionRowBuilder,
  StringSelectMenuBuilder,
  ChannelType,
  PermissionFlagsBits
} = require('discord.js');

module.exports = {
  data: new SlashCommandBuilder()
    .setName('regras')
    .setDescription('Enviar a central de regras')
    .setDefaultMemberPermissions(PermissionFlagsBits.Administrator)
    .addChannelOption(option =>
      option
        .setName('canal')
        .setDescription('Canal onde a central serÃ¡ enviada')
        .setRequired(true)
        .addChannelTypes(ChannelType.GuildText)
    ),

  async execute(interaction, client) {
    const canal = interaction.options.getChannel('canal');

    const embedPrincipal = new EmbedBuilder()
      .setTitle('ğŸ“œ Central de Regras')
      .setDescription(
        'Selecione no menu abaixo qual conjunto de regras deseja visualizar.\n\n' +
        'âš ï¸ A leitura Ã© registrada automaticamente.'
      )
      .setColor('#9c89ad');

    const menu = new StringSelectMenuBuilder()
      .setCustomId('menu_regras')
      .setPlaceholder('ğŸ“‚ Escolha um tipo de regra')
      .addOptions([
        { label: 'Regras da Cidade', value: 'cidade', emoji: 'ğŸ™ï¸' },
        { label: 'Regras de ConvivÃªncia', value: 'convivencia', emoji: 'ğŸ¤' },
        { label: 'Regras Gerais', value: 'gerais', emoji: 'ğŸ“Œ' },
        { label: 'Regras do Discord', value: 'discord', emoji: 'ğŸ’¬' }
      ]);

    const row = new ActionRowBuilder().addComponents(menu);

    /* salva o menu para o botÃ£o voltar reutilizar */
    client.selectMenus.set('menu_regras_builder', menu);

    await canal.send({
      embeds: [embedPrincipal],
      components: [row]
    });

    await interaction.reply({
      content: 'âœ… Central de regras enviada com sucesso.',
      ephemeral: true
    });
  }
};
